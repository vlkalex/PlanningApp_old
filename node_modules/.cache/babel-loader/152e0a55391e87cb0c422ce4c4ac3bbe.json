{"ast":null,"code":"import _regeneratorRuntime from\"/Users/alexvlk/Documents/Projects/GitHub/ConsultApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/Users/alexvlk/Documents/Projects/GitHub/ConsultApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/alexvlk/Documents/Projects/GitHub/ConsultApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/alexvlk/Documents/Projects/GitHub/ConsultApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/alexvlk/Documents/Projects/GitHub/ConsultApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,createContext,useEffect,useContext}from\"react\";import*as firebase from'firebase';export var UserContext=createContext({user:null});function UserProvider(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),authUser=_useState4[0],setAuthUser=_useState4[1];firebase.auth().onAuthStateChanged(function(user){setAuthUser(user.uid);});useEffect(function(){var firebaseUser=firebase.auth().currentUser;var name,email,photoUrl,uid,emailVerified;if(firebaseUser!=null){name=firebaseUser.displayName;email=firebaseUser.email;photoUrl=firebaseUser.photoURL;emailVerified=firebaseUser.emailVerified;uid=firebaseUser.uid;}firebase.auth().currentUser.getIdToken(true).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(idToken){var requestOptions;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:localStorage.setItem(\"@token\",idToken);requestOptions={method:'POST',headers:{'Content-Type':'application/json','Accept':'*/*','Authorization':'Bearer '+localStorage.getItem(\"@token\")},body:JSON.stringify({token:uid})};_context.next=4;return fetch('https://europe-west1-plannerapp-960c1.cloudfunctions.net/app/api/get-user-data',requestOptions).then(function(response){return response.json();}).then(function(data){return setUser(_objectSpread(_objectSpread({},data),{},_defineProperty({},'uid',uid)));});case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()).catch(function(error){console.log(error);});},[]);return/*#__PURE__*/React.createElement(UserContext.Provider,{value:user},props.children);}export default UserProvider;","map":{"version":3,"sources":["/Users/alexvlk/Documents/Projects/GitHub/ConsultApp/src/providers/UserProvider.js"],"names":["React","useState","createContext","useEffect","useContext","firebase","UserContext","user","UserProvider","props","setUser","authUser","setAuthUser","auth","onAuthStateChanged","uid","firebaseUser","currentUser","name","email","photoUrl","emailVerified","displayName","photoURL","getIdToken","then","idToken","localStorage","setItem","requestOptions","method","headers","getItem","body","JSON","stringify","token","fetch","response","json","data","catch","error","console","log","children"],"mappings":"g1BAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,aAA1B,CAAyCC,SAAzC,CAAoDC,UAApD,KAAsE,OAAtE,CACA,MAAO,GAAKC,CAAAA,QAAZ,KAA0B,UAA1B,CAEA,MAAO,IAAMC,CAAAA,WAAW,CAAGJ,aAAa,CAAC,CAAEK,IAAI,CAAE,IAAR,CAAD,CAAjC,CAEP,QAASC,CAAAA,YAAT,CAAsBC,KAAtB,CAA6B,eAEHR,QAAQ,CAAC,EAAD,CAFL,wCAEpBM,IAFoB,eAEdG,OAFc,8BAGKT,QAAQ,EAHb,yCAGpBU,QAHoB,eAGVC,WAHU,eAM3BP,QAAQ,CAACQ,IAAT,GAAgBC,kBAAhB,CAAmC,SAACP,IAAD,CAAU,CAC3CK,WAAW,CAACL,IAAI,CAACQ,GAAN,CAAX,CACD,CAFD,EAGAZ,SAAS,CAAC,UAAM,CACd,GAAIa,CAAAA,YAAY,CAAGX,QAAQ,CAACQ,IAAT,GAAgBI,WAAnC,CACA,GAAIC,CAAAA,IAAJ,CAAUC,KAAV,CAAiBC,QAAjB,CAA2BL,GAA3B,CAAgCM,aAAhC,CAEA,GAAIL,YAAY,EAAI,IAApB,CAA0B,CACxBE,IAAI,CAAGF,YAAY,CAACM,WAApB,CACAH,KAAK,CAAGH,YAAY,CAACG,KAArB,CACAC,QAAQ,CAAGJ,YAAY,CAACO,QAAxB,CACAF,aAAa,CAAGL,YAAY,CAACK,aAA7B,CACAN,GAAG,CAAGC,YAAY,CAACD,GAAnB,CACD,CAEDV,QAAQ,CAACQ,IAAT,GAAgBI,WAAhB,CAA4BO,UAA5B,CAAuC,IAAvC,EAA6CC,IAA7C,0FAAkD,iBAAeC,OAAf,qIAChDC,YAAY,CAACC,OAAb,CAAqB,QAArB,CAA+BF,OAA/B,EAEMG,cAH0C,CAGzB,CACrBC,MAAM,CAAE,MADa,CAErBC,OAAO,CAAE,CAAE,eAAgB,kBAAlB,CAAsC,SAAU,KAAhD,CAAuD,gBAAiB,UAAYJ,YAAY,CAACK,OAAb,CAAqB,QAArB,CAApF,CAFY,CAGrBC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CAAEC,KAAK,CAAErB,GAAT,CAAf,CAHe,CAHyB,uBAQ1CsB,CAAAA,KAAK,CAAC,gFAAD,CAAmFR,cAAnF,CAAL,CACDJ,IADC,CACI,SAAAa,QAAQ,QAAIA,CAAAA,QAAQ,CAACC,IAAT,EAAJ,EADZ,EAEDd,IAFC,CAEI,SAAAe,IAAI,QAAI9B,CAAAA,OAAO,gCAAM8B,IAAN,wBAAa,KAAb,CAAsBzB,GAAtB,GAAX,EAFR,CAR0C,uDAAlD,gEAWG0B,KAXH,CAWS,SAASC,KAAT,CAAgB,CACvBC,OAAO,CAACC,GAAR,CAAYF,KAAZ,EACD,CAbD,EAeD,CA3BQ,CA2BN,EA3BM,CAAT,CA6BA,mBACE,oBAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAEnC,IAA7B,EACGE,KAAK,CAACoC,QADT,CADF,CAKD,CAED,cAAerC,CAAAA,YAAf","sourcesContent":["import React, { useState, createContext, useEffect, useContext } from \"react\";\nimport * as firebase from 'firebase';\n\nexport const UserContext = createContext({ user: null });\n\nfunction UserProvider(props) {\n\n  const [user, setUser] = useState([]);\n  const [authUser, setAuthUser] = useState();\n\n\n  firebase.auth().onAuthStateChanged((user) => {\n    setAuthUser(user.uid);\n  })\n  useEffect(() => {\n    var firebaseUser = firebase.auth().currentUser;\n    var name, email, photoUrl, uid, emailVerified;\n\n    if (firebaseUser != null) {\n      name = firebaseUser.displayName;\n      email = firebaseUser.email;\n      photoUrl = firebaseUser.photoURL;\n      emailVerified = firebaseUser.emailVerified;\n      uid = firebaseUser.uid;\n    }\n\n    firebase.auth().currentUser.getIdToken(true).then(async function(idToken) {\n      localStorage.setItem(\"@token\", idToken)\n\n      const requestOptions = {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json', 'Accept': '*/*', 'Authorization': 'Bearer ' + localStorage.getItem(\"@token\") },\n        body: JSON.stringify({ token: uid })\n      };\n      await fetch('https://europe-west1-plannerapp-960c1.cloudfunctions.net/app/api/get-user-data', requestOptions)\n          .then(response => response.json())\n          .then(data => setUser({ ...data, ['uid'] : uid  }));\n    }).catch(function(error) {\n      console.log(error);\n    });\n    \n  }, []);\n\n  return (\n    <UserContext.Provider value={user}>\n      {props.children}\n    </UserContext.Provider>\n  );\n}\n\nexport default UserProvider;\n"]},"metadata":{},"sourceType":"module"}